<%# タイトル %>
<% content_for :title, @random_set.name %>

<%# random_set情報 %>
<%= turbo_frame_tag "random_set" do %>
  <div data-controller="randomizer">
    <div class="card mt-3">
      <div class="card-header">
        <div class="d-flex">
          <div class="col-8 d-flex align-items-center">
            <i class="bi bi-journal">セット情報</i>
          </div>
          <div class="col-4 mt-auto d-flex justify-content-end">
            <%= link_to "編集", edit_random_set_path(@random_set),
              class: "btn btn-secondary",
              data: { turbo_frame: "modal" } 
            %>
          </div>
        </div>
      </div>
      <div class="card-body mt-3">
        <%= turbo_frame_tag "random_set_info" do %>
          <div class="row mt-auto">
            <div class="col">
              <p>セット名称：<%= @random_set.name %></p>
              <% if @random_set.dict.present? %>
                <div class="col">
                  <p>セット説明：<%= @random_set.dict %></p>
                </div>
              <% end %>
              <%# ModおよびValiant用 %>
              <% if @random_set.parent.present? %>
                <div class="col">
                  <%= link_to @parent_set.name, random_set_lottery_path(@parent_set), class: "btn btn-outline-secondary", data: { turbo_frame: "random_set" } %>
                </div>
              <% end %>
            </div>
          </div>
          <div class="row mt-auto">
            <div class="col">
              <%= render "infomation" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>

    <%= turbo_frame_tag "random_set_lotteries" do %>
      <%# ランダマイザー機能 %>
      <div class="card mt-3">
        <div class="card-header">
          <i class="bi bi-dice-3-fill">ランダマイザー</i>
        </div>
        <div class="card-body">
          <div class="row">
            <div class="col-md">
              <ul class="list-unstyled">
                <li>
                  <div class="btn-group" role="group">
                    <button class="btn btn-primary mb-1" data-action="click->randomizer#oneDraw">１回引く</button>
                    <button class="btn btn-primary mb-1" data-action="click->randomizer#anyDraw" data-count=10>１０回引く</button>
                    <button class="btn btn-primary mb-1" data-action="click->randomizer#anyDraw" data-count=100>１００回引く</button> 
                  </div>
                </li>
                <li><button class="btn btn-primary mb-1" data-action="click->randomizer#specifiedDraw">全てから指定数引く</button></li>
                <li><button class="btn btn-primary mb-1" data-action="click->randomizer#drawToTarget">指定の物が出るまで引く</button></li>
                <br>
                <li><button class="btn btn-primary mb-1" data-action="click->randomizer#checkedSpecifiedDraw">チェックされているものから指定数引く</button></li>
                <li><button class="btn btn-primary mb-1" data-action="click->randomizer#checkedDrawTarget">チェックされているものから指定の物が出るまで引く</button></li>
                <br>
                <li><button class="btn btn-primary mb-1" data-action="click->randomizer#uncheckedSpecifiedDraw">非チェックから指定数引く</button></li>
                <li><button class="btn btn-primary mb-1" data-action="click->randomizer#uncheckedDrawToTarget">非チェックから指定の物が出るまで引く</button></li>
              </ul>
            </div>
            <div class="col-md">
              <div class="card">
                <div class="card-header">
                  <i class="bi bi-wrench-adjustable">ランダマイザー設定</i>
                </div>
                <div class="card-body">
                  <div class="input-group mb-4">
                    <label for="randomSeed" class="input-group-text">シード値</label>
                    <input id="randomSeed" data-randomizer-target="seed" name="randomSeed" type="number" class="form-control" placeholder="未設定時は自動生成" data-controller="tooltip" data-tooltip="変更されると自動的にシード値の再設定が行われます。"/>
                    <button class="btn btn-primary" data-action="click->randomizer#setSeed" data-controller="tooltip" data-tooltip="現在の値でシード値を再設定します。これにより、シード値のリセットが行われます。">決定</button>
                  </div>
                  <div class="input-group mb-4">
                    <label for="anyDrawNumber" class="input-group-text">指定数</label>
                    <input id="anyDrawNumber" data-randomizer-target="specifiedNumber" name="anyDrawNumber" type="number" class="form-control" placeholder="正数のみ有効、マイナスは無効" value=1 />
                  </div>
                  <div class="card mb-1">
                    <div class="card-header">
                      <i class="bi bi-disc-fill">疑似乱数生成方式</i>
                    </div>
                    <div class="card-body">
                      <div class="form-check">
                        <label for="checkMT" class="from-check-label" data-controller="tooltip" data-tooltip="近年において一般的に広く使われる方式">メルセンヌツイスタ</label>
                        <input id="checkMT" data-randomizer-target="randomizerSwitch" name="randomizerSwitched" type="radio" class="form-check-input" value="MersseneTwister" checked>
                      </div>
                      <div class="form-check">
                        <label for="checkXorShift" class="form-check-label" data-controller="tooltip" data-tooltip="排他的論理和とビットシフトのみの高速な処理">XorShift</label>
                        <input id="checkXorShift" data-randomizer-target="randomizerSwitch" name="randomizerSwitched" type="radio" class="form-check-input" value="XorShift">
                      </div>
                      <div class="form-check">
                        <label for="checkLCGs" class="form-check-label" data-controller="tooltip" data-tooltip="非推奨。最小メモリで高速に演算しますが、偶数奇数が交互に発生する問題があります。">線形合同方式</label>
                        <input id="checkLCGs" data-randomizer-target="randomizerSwitch" name="randomizerSwitched" type="radio" class="form-check-input" value="LinearCGs">
                      </div>
                      <div class="form-check">
                        <label for="checkMathRandom" class="form-check-label" data-controller="tooltip" data-tooltip="線形合同方式などの個々のJavascript実装に依存します。Seed設定無効">Math.Random</label>
                        <input id="checkMathRandom" data-randomizer-target="randomizerSwitch" name="randomizerSwitched" type="radio" class="form-check-input" value="MathRandom">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <%# 結果表示 %>
      <div class="card mt-3">
        <div class="card-header">
          <div class="row">
            <div class="col d-flex align-items-center">
              <i class="bi bi-dice-3">結果表示</i>
            </div>
            <div class="col d-flex justify-content-end">
              <button class="btn btn-danger btn-small" data-action="click->randomizer#resetResult">結果リセット</button>
            </div>
          </div>
        </div>
        <div class="card-body text-wrap">
          <table class="table table-hover table-striped table-sm" data-controller="table-sort" data-randomizer-target="resultTable">
            <thead>
              <tr>
                <th class="sortable" data-sort="number" data-action="click->table-sort#sort" data-table-sort-target="tableHeader">Reality</th>
                <th class="sortable" data-sort="string" data-action="click->table-sort#sort" data-table-sort-target="tableHeader">Name</th>   
                <th class="sortable" data-sort="number" data-action="click->table-sort#sort" data-table-sort-target="tableHeader">ヒット数</th>     
                <th class="sortable" data-sort="number" data-action="click->table-sort#sort" data-table-sort-target="tableHeader">ヒット割合</th>
              </tr>
            </thead>
            <tbody class="table-group-divider">
            </tbody>
          </table>
        </div>
      </div>

      <%# 要素確認 %>
      <div class="card mt-3">
        <div class="card-header">
          <i class="bi bi-database">セット内容</i>
        </div>
        <div class="card-body">
          <ul class="list-unstyled">
            <%= render "randomset_lotteries" %>
          </ul>
        </div>
      </div>
    <% end %>
  </div>
  <%# トースト要素 %>
  <div class="toast-container position-fixed top-0 end-0 p-3" >
    <div class="toast" role="alert" aria-atomic="true" id="toast">
      <div class="toast-header">
        <strong class="me-auto" id="toastHeader"></strong>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body">
        <span id="toastBody"></span>
      </div>
    </div>
  </div>
<% end %>
